# Plan 02-01: Create /gs:cancel Command File

**Phase:** 02-cancel-command
**Wave:** 1
**Depends on:** none

## Goal

Create `commands/gs/cancel.md` — the full markdown prompt that implements the /gs:cancel
command. This file is auto-discovered by bin/install.js and shipped in the npm package with
no further registration. It gives users a safe, confirmed abort path for a partial /gs:init
by inspecting the filesystem, listing found artifacts, asking for confirmation, removing
them, and printing a clear result.

## Pre-conditions

- `commands/gs/` directory exists and contains other `.md` command files
- `commands/gs/cancel.md` does NOT yet exist
- `bin/install.js` auto-discovers every `.md` file in `commands/gs/` — no registration needed

## Tasks

### Task 1: Create commands/gs/cancel.md

**Action:** Create

**File:** `/Users/sharvyahmed/open-source/go-spec/commands/gs/cancel.md`

**Details:**

Write the file with exactly the following content (copy verbatim):

```markdown
# /gs:cancel — Abort an In-Progress Initialization

Safely stop a /gs:init that was abandoned mid-flow. Inspects the filesystem for partial
artifacts, asks for confirmation, removes them, and reports the result.

---

## When to Use

- You started /gs:init but stopped before it completed
- You want to start over from scratch after a partial run
- You see stale `.spec/` artifacts from a failed or interrupted init

---

## Process

### Step 1: Check Filesystem State

Check for the presence of `.spec/PROJECT.md` and `.spec/STATE.md`.

**Case A — Nothing to cancel:**
If `.spec/` does not exist, or if `.spec/PROJECT.md` does not exist:
```
Nothing to cancel. No in-progress /gs:init found.
```
Stop here.

**Case B — Init already completed:**
If both `.spec/PROJECT.md` AND `.spec/STATE.md` exist:
```
Nothing to cancel. /gs:init completed successfully.
Use /gs:status to see project progress.
```
Stop here.

**Case C — Partial init detected:**
If `.spec/PROJECT.md` exists AND `.spec/STATE.md` does NOT exist: proceed to Step 2.

---

### Step 2: List Artifacts Found

Scan for each of the following paths and note which ones are present:

| Path | Type |
|------|------|
| `.spec/PROJECT.md` | file |
| `.spec/REQUIREMENTS.md` | file |
| `.spec/ROADMAP.md` | file |
| `.spec/research/` | directory |
| `.spec/config.json` | file |
| `.spec/phases/` | directory |
| `.spec/quick/` | directory |
| `.spec/milestones/` | directory |
| `.spec/todos/` | directory |
| `.spec/debug/` | directory |

Print only the paths that are present:

```
Partial /gs:init detected. The following artifacts will be removed:

  .spec/PROJECT.md
  [list only what exists — one path per line]

The .spec/ directory itself will NOT be removed.
```

---

### Step 3: Ask for Confirmation

Print:

```
Remove these artifacts? (yes/no)
```

Wait for user input.

If the user types anything other than `yes` (case-insensitive):
```
Cancelled. No files were removed.
```
Stop here.

---

### Step 4: Remove Artifacts

For each artifact that is present, remove it:

- `.spec/PROJECT.md` — delete file
- `.spec/REQUIREMENTS.md` — delete file (if present)
- `.spec/ROADMAP.md` — delete file (if present)
- `.spec/research/` — delete directory and all contents (if present)
- `.spec/config.json` — delete file (if present)
- `.spec/phases/` — delete only if the directory is empty; skip if it contains files
- `.spec/quick/` — delete only if the directory is empty; skip if it contains files
- `.spec/milestones/` — delete only if the directory is empty; skip if it contains files
- `.spec/todos/` — delete only if the directory is empty; skip if it contains files
- `.spec/debug/` — delete only if the directory is empty; skip if it contains files

Do NOT remove `.spec/` itself.
Do NOT perform any git operations.

---

### Step 5: Print Confirmation

Print a summary of what was removed and what was skipped (with reason):

```
Done. Removed:
  .spec/PROJECT.md
  [one line per removed artifact]

Skipped (not empty):
  .spec/phases/       ← contains existing files
  [only list directories that were skipped because non-empty]

/gs:init can now be run again from the beginning.
```

If nothing was skipped, omit the "Skipped" block entirely.
```

**Done when:** The file `/Users/sharvyahmed/open-source/go-spec/commands/gs/cancel.md` exists and its content matches the above verbatim (including all heading levels, fenced blocks, table, and blank lines).

## Success Criteria

- [ ] `commands/gs/cancel.md` exists
- [ ] File begins with `# /gs:cancel — Abort an In-Progress Initialization`
- [ ] File contains five numbered steps under `## Process`
- [ ] Step 1 defines all three cases (A, B, C) with exact output strings
- [ ] Step 2 contains the artifact table with all 10 paths
- [ ] Step 3 requires explicit `yes` confirmation before any deletion
- [ ] Step 4 specifies that non-empty scaffold directories are skipped, not deleted
- [ ] Step 5 prints a confirmation summary distinguishing removed vs. skipped
- [ ] File does NOT instruct any git operations
- [ ] File does NOT instruct removal of `.spec/` itself

## Deviation Policy

**Auto-fix (no need to stop):**
- Whitespace or blank-line inconsistencies that do not change meaning
- Fixing a typo in a non-instruction word

**Stop and report:**
- Any instruction in the file would cause destructive action beyond the artifact list (e.g., removing `.spec/` itself or running git commands)
- The auto-discovery mechanism in `bin/install.js` turns out to require explicit registration for new command files — stop and report before proceeding

## Notes for Executor

The inner fenced code blocks inside the file contain triple backticks. When writing the
file, the outer fencing in this plan uses ` ```markdown ` / ` ``` ` delimiters only for
display in the plan. Write the actual file content — do not wrap the file in an outer
fenced block when saving it to disk.

The "Case A / B / C" branch structure in Step 1 is intentional: it mirrors the three-state
detection heuristic from 02-RESEARCH.md. Do not collapse or reorder the cases.

The scaffold directories (phases/, quick/, milestones/, todos/, debug/) must only be
removed when empty. A user may have pre-existing content in them (e.g., from /gs:map or a
prior completed init). The "skip if non-empty" rule prevents data loss.
